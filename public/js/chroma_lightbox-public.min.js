jQuery(function($){function hexToRgb(hex){var bigint=parseInt(hex,16);return(bigint>>16&255)+","+(bigint>>8&255)+","+(255&bigint)}var crolog=function(){},options=chroma_lightbox_public_vars.options,settings=(chroma_lightbox_public_vars.img_sizes,options.settings),gallery_active=settings["gallery-active"],thumbs_active=settings["thumbs-active"],frame_active=settings["frame-active"],frame_width=settings["frame-width"],frame_opacity=(settings["frame-color"],settings["frame-opacity"]),frame_active_tn=settings["frame-active-tn"],frame_width_tn=settings["frame-width-tn"],frame_opacity_tn=(settings["frame-color-tn"],settings["frame-opacity-tn"]);crolog();chroma_lightbox_public_vars.plugin_path;var img_height,img_width,current_article,spinner,inputtype,slideshow={drag:0,stop:0},loading=0,apply_settings=function(){if($("#clb-exit-box").css({"background-color":settings["background-color"],opacity:settings["background-opacity"]}),$("#clb-thumbs-table a").css({"border-color":settings["frame-color"]}),frame_active){var dec_color=hexToRgb(settings["frame-color"].replace(/\W/g,""));$("#clb-frame").css({"border-style":"solid","border-color":"rgba("+dec_color+", "+frame_opacity+")","border-width":frame_width+"px"})}if(frame_active_tn){var dec_color_tn=hexToRgb(settings["frame-color-tn"].replace(/\W/g,""));$("#clb-thumbs-table a").css({"border-style":"solid","border-color":"rgba("+dec_color_tn+", "+frame_opacity_tn+")","border-width":frame_width_tn+"px"}),$("#clb-thumbs-table a.clb-thumb-active").css({"border-width":parseInt(frame_width_tn)+3+"px"})}},gallery_nav_update=function(){gallery_active?($("#clb-button-prev, #clb-button-next").show(),thumbs_active?$("#clb-thumbs").show():$("#clb-thumbs").hide()):$("#clb-button-prev, #clb-button-next, #clb-thumbs").hide()},active_thumb_class=function(atag){$("#clb-thumbs a").removeClass("clb-thumb-active"),$("#clb-thumbs a[href='"+atag.attr("href")+"']").addClass("clb-thumb-active")},populate_thumbs=function(atag){if(atag.parents("#clb-thumbs").length>0)return active_thumb_class(atag),void apply_settings();var article,links=(article=atag.parents(settings["wrapper-element"]).first()).find("img").parents("a");article.hasClass("clb-current-article")?crolog():(crolog(),$(".clb-current-article").removeClass("clb-current-article"),article.addClass("clb-current-article"),current_article=article,$("#clb-thumbs-table").html(""),links.length>1?(gallery_nav_update(),$.each(links,function(){$("#clb-thumbs-table").prepend($(this)[0].outerHTML);var added=$("#clb-thumbs-table a").first();added.removeAttr("style"),added.find("*").not("img").remove();var src=added.find("img").first().attr("src");added.css({"background-image":"url("+src+")"})})):$("#clb-button-prev, #clb-button-next, #clb-thumbs").hide()),active_thumb_class(atag),apply_settings()},build_lightbox=function(){(new Date).getTime();var s="";s+="<div id='clb-container'>",s+="<div id='clb-exit-box'></div>",s+="<div id='clb-spinner'>",s+="</div>",s+="<div id='clb-frame'>",s+="<div id='clb-main-image-crop'>",s+="<div id='clb-main-image-container'>",s+="<img id='clb-main-image' src=''>",s+="</div>",s+="</div>",s+="<div id='clb-caption'></div>",s+="<div id='clb-controls'>",s+="<div id='clb-button-prev' class='clb-button'></div>",s+="<div id='clb-button-next' class='clb-button'></div>",s+="<div id='clb-button-close' class='clb-button'></div>",s+="</div>",s+="</div>",s+="<div id='clb-thumbs'>",s+="<div id='clb-thumbs-table'>",s+="</div>",s+="</div>",s+="</div>",$("body").prepend(s),gallery_nav_update(),spinner=$("#clb-spinner")},clb_resize=function(){crolog();var new_img_height=img_height,new_img_width=img_width,win_width=1*$(window).width(),win_height=1*$(window).height();img_height<win_height&&img_width<win_width&&(crolog(),$("#clb-frame").css({height:img_height,width:img_width}),$("#clb-frame #clb-main-image").css({height:img_height,width:img_width})),img_height>win_height&&(crolog(),$("#clb-frame #clb-main-image").css({height:win_height,width:"auto"}),new_img_height=$("#clb-frame #clb-main-image").height(),new_img_width=$("#clb-frame #clb-main-image").width(),$("#clb-frame").css({height:new_img_height,width:new_img_width})),new_img_width>win_width&&(crolog(),$("#clb-frame #clb-main-image").css({width:win_width,height:"auto"}),new_img_height=$("#clb-frame #clb-main-image").height(),new_img_width=$("#clb-frame #clb-main-image").width(),$("#clb-frame").css({height:new_img_height,width:new_img_width}));var but={prev:$("#clb-button-prev"),next:$("#clb-button-next"),close:$("#clb-button-close")};if(new_img_width>win_width-2*(but.prev.width()+frame_width)){but.prev.offset().left;but.prev.css({left:0}),but.next.css({right:0}),but.close.css({right:0})}else but.prev.css({left:-(but.prev.width()+frame_width)}),but.next.css({right:-(but.prev.width()+frame_width)}),but.close.css({right:-(but.prev.width()+frame_width)});$("#clb-frame").css({})},bind_img_load=function(){$("#clb-frame #clb-main-image").load(function(img_loaded){spinner.fadeOut(500),img_height=img_loaded.currentTarget.naturalHeight,img_width=img_loaded.currentTarget.naturalWidth,setTimeout(function(){clb_resize()},0),$("#clb-frame").css({opacity:1},500),$("#clb-main-image").fadeIn(500),""!==$("#clb-caption").text()&&$("#clb-caption").fadeIn(1e3),loading=0})},reset_slideshow=function(){slideshow.width=$("#clb-main-image-container").width()};$(document).ready(function(){crolog(),build_lightbox(),apply_settings(),bind_img_load(),gallery_active&&($(document).on("mousedown touchstart","#clb-main-image-container",function(e){e.preventDefault(),1!==slideshow.stop&&(crolog(),reset_slideshow(),slideshow.frame=$("#clb-main-image-container"),slideshow.temp=$("#clb-main-image-crop").find("div").last(),slideshow.temp=slideshow.frame,setTimeout(function(){slideshow.frame.show(),slideshow.frame.css({})},100),"mousedown"==e.type?inputtype="mouse":"touchstart"==e.type&&(inputtype="touch"),slideshow.drag=1,slideshow.anchor="mouse"==inputtype?e.screenX:e.originalEvent.touches[0].screenX,slideshow.offset=0,slideshow.dir=0,slideshow.stop=1)}),$(document).on("mouseup touchend",function(e){1==slideshow.drag&&(e.preventDefault(),crolog(),slideshow.drag=0,slideshow.drop=e.screenX,slideshow.frame.addClass("clb-slideshow-trans"),slideshow.offset>-10&&slideshow.offset<10&&(slideshow.dir=0),0===slideshow.dir?e.offsetX>slideshow.width/2?(slideshow.dir=1,slideshow.offset=-100):(slideshow.dir=2,slideshow.offset=100):spinner.fadeIn(50),2==slideshow.dir?slideshow.offset>0?(slideshow.frame.css({transform:"translateX("+slideshow.width+"px)"}),setTimeout(function(){$("#clb-button-prev").trigger("click")},700)):slideshow.frame.css({transform:"translateX(0px)"}):1==slideshow.dir?slideshow.offset<0?(slideshow.frame.css({transform:"translateX(-"+slideshow.width+"px)"}),setTimeout(function(){$("#clb-button-next").trigger("click")},700)):slideshow.frame.css({transform:"translateX(0px)"}):slideshow.dir,setTimeout(function(){slideshow.stop=0,slideshow.frame.css({transform:"translateX(0px)"}),slideshow.frame.removeClass("clb-slideshow-trans")},700))}),$(document).on("mousemove touchmove",function(e){1==slideshow.drag&&(e.preventDefault(),crolog(),slideshow.curpos=slideshow.offset,slideshow.offset=e.screenX-slideshow.anchor,slideshow.offset="mouse"==inputtype?e.screenX-slideshow.anchor:e.originalEvent.touches[0].screenX-slideshow.anchor,slideshow.curpos>slideshow.offset?slideshow.dir=1:slideshow.curpos<slideshow.offset&&(slideshow.dir=2),slideshow.curpos=slideshow.offset,slideshow.temp.css({transform:"translateX("+slideshow.offset+"px)"}))})),$(document).on("click",settings.target,function(e){var href=$(this).attr("href"),match=href.match(/jpg|gif|png|bmp/gi);if(1==$(this).children("img").length&&match&&(e.preventDefault(),1!=loading)){crolog(),loading=1,spinner.fadeIn(50);var aclicked=$(this);populate_thumbs(aclicked),aclicked.parents("#clb-thumbs").length>0&&(crolog(),aclicked=current_article.find("a[href='"+$(this).attr("href")+"']"));var caption=aclicked.find(".clb-caption-text");if(crolog(),caption.length>0)caption=caption.text();else{caption=aclicked.parent().find(".wp-caption-text").html();var img=aclicked.find("img[aria-describedby]");img.length>0&&(caption=$("#"+img.attr("aria-describedby")).html())}$("#clb-caption").hide().empty().html(caption),$("#clb-container").fadeIn(250),$("#wrapper").css({filter:"blur(3px)"}),$("#clb-main-image").hide();var src=$(this).children("img").attr("src"),matches=/(.*)\/(.*)(?:-\d*x\d*)\.(jpeg|jpg|png|gif)/g.exec(src);crolog(),src=src.replace(/-\d*x\d*\.(jpeg|jpg|png|gif)/g,".$1"),src=matches[1]+"/"+matches[2]+"."+matches[3],src=href;$("#clb-frame #clb-main-image").attr("src",src)}}),$(document).on("click",".clb-button",function(){crolog();var cur_img=$(".clb-thumb-active");(cur_img="clb-button-prev"==$(this).attr("id")?cur_img.prev().length>0?cur_img.prev():$("#clb-thumbs img").last():cur_img.next().length>0?cur_img.next():$("#clb-thumbs img").first()).trigger("click")}),$(document).on("click","#clb-exit-box, #clb-button-close",function(){$("#clb-container").fadeOut(250),$("#clb-frame").height(300),$("#clb-frame").width(300),$("#clb-frame").css({opacity:0}),$("#wrapper").css({filter:"blur(0px)"})}),$(window).on("resize",function(){clb_resize()})})});